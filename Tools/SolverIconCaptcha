// ==UserScript==
// @name         Solver IconCaptcha
// @namespace    bFcSn Script
// @version      0.1
// @description  Solves Icon Captcha
// @author       bFcSnBlogger Modif from engageub
// @match        https://rsadnetworkinfo.com/*
// @match        https://rseducationinfo.com/*
// @match        https://rshostinginfo.com/*
// @match        https://rsfinanceinfo.com/*
// @match        https://rsinsuranceinfo.com/*
// @match        https://rssoftwareinfo.com/*
// @require      https://unpkg.com/jimp@0.5.2/browser/lib/jimp.min.js
// @run-at       document-start
// @grant        none
// ==/UserScript==

"use strict";Object.defineProperty(window,"IconCaptcha",{get:()=>abcde(),set(e){clickHolderButton()}});var intervalCount=0,SOLVING=!1;function clickHolderButton(){SOLVING||(SOLVING=!0,setInterval((function(){document.querySelector(".iconcaptcha-holder")&&document.querySelector(".iconcaptcha-holder").innerText.includes("VERIFY")&&document.querySelector(".iconcaptcha-holder").click()}),7e3))}function abcde(){var e={},t={general:{validationPath:null,fontFamily:null,credits:"show"},security:{clickDelay:1500,hoverDetection:!0,enableInitialMessage:!0,initializeDelay:500,selectionResetDelay:3e3,loadingAnimationDelay:1e3,invalidateTime:12e4},messages:{initialization:{loading:"Loading challenge...",verify:"Verify that you are human."},header:"Select the image displayed the <u>less frequent</u> of times",correct:"Verification complete.",incorrect:{title:"Uh oh.",subtitle:"You've selected the wrong image."},timeout:{title:"Please wait 60 sec.",subtitle:"You made too many incorrect selections."}}},a="https://www.fabianwennink.nl/projects/IconCaptcha",n="IconCaptcha by Fabian Wennink";e.$init=function(e,t){return o(this,e,t),this},e.init=function(e,t){return o(this,document.querySelectorAll(e),t),this},e.reset=function(e){return void 0===this.instances?console.error("IconCaptcha has not yet been initialized. Cannot use 'reset' yet."):void 0===e?i(this.instances,(function(e){null!=e&&e.reset()})):null!==(t=this.instances.find((function(t){return t.id===e})))&&void 0!==t&&t.reset(),this;var t},e.bind=function(e,t){return void 0===this.nodes?console.error("IconCaptcha has not yet been initialized. Cannot use 'bind' yet."):i(this.nodes,(function(a){a.addEventListener(e,t)})),this};var i=function(e,t){for(var a=0;a<e.length;a++)t(e[a],a)},o=function(e,a,n){var o;e.nodes||(e.instances=[],e.nodes=a,o=IconCaptchaPolyfills.extend({},t,n||{}),i(e.nodes,(function(t,a){e.instances.push(c(t,a,o))})))},c=function(e,t,o){var c,r,l,s=t+1,d=e,h=!1,u=null,p=0,v=!1,g=0,f=!1,m=!1;if(o.general.validationPath)return y(),{id:s,reset:function(){S(),m=f=v=h=!1,IconCaptchaPolyfills.trigger(d,"reset",{captchaId:s}),y()}};function y(){l=null===(e=document.querySelector('input[name="_iconcaptcha-token"]'))||void 0===e?void 0:e.value;var e,t=d.getAttribute("data-theme")||"light";if(d.classList.add("iconcaptcha-theme-"+t),o.general.fontFamily&&(d.style.fontFamily=o.general.fontFamily),!h&&o.security.enableInitialMessage)return o.security.enableInitialMessage&&d.addEventListener("click",(function(e){h||e.target instanceof HTMLAnchorElement||(h=!0,d.querySelector(".iconcaptcha-modal__body-circle").style.animationDuration="2s",d.querySelector(".iconcaptcha-modal__body-title").innerText=o.messages.initialization.loading,setTimeout((function(){d.classList.remove("iconcaptcha-init"),y()}),o.security.initializeDelay))})),e=["<div class='iconcaptcha-modal'>","<div class='iconcaptcha-modal__body'>","<div class='iconcaptcha-modal__body-circle'></div>","<div class='iconcaptcha-modal__body-info'>","<a href='".concat(a,"' target='_blank' rel='follow' title='").concat(n,"'>IconCaptcha &copy;</a>"),"</div>","<div class='iconcaptcha-modal__body-title'>".concat(o.messages.initialization.verify,"</div>"),"</div>","</div>"],d.classList.add("iconcaptcha-init"),d.classList.remove("iconcaptcha-error","iconcaptcha-success"),void(d.innerHTML=e.join(""));v||function(){var e,t=[];t.push("<div class='iconcaptcha-modal'>","<div class='iconcaptcha-modal__header'>","<span>".concat(o.messages.header,"</span>"),"</div>","<div class='iconcaptcha-modal__body'>","<div class='iconcaptcha-modal__body-icons'></div>","</div>","<div class='iconcaptcha-modal__footer'>"),"show"!==o.general.credits&&"hide"!==o.general.credits||(e="hide"===o.general.credits?"display: none":"",t.push("<span style='".concat(e,"'><a href='").concat(a,"' target='_blank' rel='follow' title='").concat(n,"'>IconCaptcha</a> &copy;</span>"))),t.push("</div>","<div class='iconcaptcha-modal__fields'>","<input type='hidden' name='ic-hf-se' required />","<input type='hidden' name='ic-hf-id' value='".concat(s,"' required />"),"<input type='hidden' name='ic-hf-hp' required />","</div>"),t.push("</div>"),d.innerHTML=t.join(""),c=d.querySelector(".iconcaptcha-modal__body")}(),C(),o.security.loadingAnimationDelay&&0<o.security.loadingAnimationDelay&&!o.security.enableInitialMessage?setTimeout((function(){return _(t)}),o.security.loadingAnimationDelay):_(t)}function _(e){e=P({i:s,a:1,t:e,tk:l}),IconCaptchaPolyfills.ajax({url:o.general.validationPath,type:"post",headers:T(l),data:{payload:e},success:async function(e){if(e&&"string"==typeof e){var t=JSON.parse(atob(e));if(t.error)return void function(e,t){switch(e=parseInt(e)){case 1:I(o.messages.timeout.title,o.messages.timeout.subtitle,!1);var a=d.querySelector(".iconcaptcha-modal__header");a.parentNode.removeChild(a),IconCaptchaPolyfills.trigger(d,"timeout",{captchaId:s}),setTimeout((function(){return k(!1)}),t);break;case 2:L(!0,"The captcha token is missing or is incorrect.","A server request was made without including a captcha token, however this option is enabled.");break;default:L(!0,"An unexpected error occurred.","An unexpected error occurred while IconCaptcha performed an action.")}}(t.error,t.data);e=P({i:s,tk:l}),t=c.querySelector(".iconcaptcha-modal__body-icons");var a="";return t.style.backgroundImage=await new Promise((function(n){Jimp.read(window.location.origin+"/"+o.general.validationPath+"?payload="+e).then((function(e){e.getBase64(Jimp.AUTO,(function(e,i){a=i,t.style.backgroundImage="url("+i+")",setTimeout((function(){solveCaptcha(i)}),3e3),n(t.style.backgroundImage)}))}))})),function(e){(e=new Image).onload=function(){var e;c.classList.remove("captcha-opacity");var t=c.querySelector(".captcha-loader");null==t||null!==(e=t.parentNode)&&void 0!==e&&e.removeChild(t)},e.src=a,e.complete&&e.onload(this)}(t),t.parentNode.insertAdjacentHTML("beforeend",'<div class="iconcaptcha-modal__body-selection"><i></i></div>'),r=c.querySelector(".iconcaptcha-modal__body-selection > i"),function(e){for(var t in e._ic_listeners={click:function(e){var t,a,n;new Date-g<=o.security.clickDelay||o.security.hoverDetection&&!m||(t=IconCaptchaPolyfills.offset(e.currentTarget),a=e.pageX-t.left,n=e.pageY-t.top,a&&n&&(c.classList.contains("captcha-opacity")||(IconCaptchaPolyfills.trigger(d,"selected",{captchaId:s}),o.security.loadingAnimationDelay&&0<o.security.loadingAnimationDelay?(C(),setTimeout((function(){return b(a,n)}),o.security.loadingAnimationDelay)):b(a,n))))},mousemove:function(e){m&&!f&&v&&D(e)},mouseenter:function(e){r.style.display="inline",D(e),m=!0},mouseleave:function(){r.style.display="none",m=!1}},e._ic_listeners)e.addEventListener(t,e._ic_listeners[t])}(d.querySelector(".iconcaptcha-modal__body-selection")),v||IconCaptchaPolyfills.trigger(d,"init",{captchaId:s}),t=c.querySelector(".iconcaptcha-modal__body-selection"),p=IconCaptchaPolyfills.width(t),g=new Date,v=!0,void(u=setTimeout((function(){return k(!0)}),o.security.invalidateTime))}L(!0,"The IconCaptcha could not be loaded.","Invalid data was returned by the captcha back-end service. Make sure IconCaptcha is installed/configured properly.")},error:function(){return I()}})}function w(){d.classList.remove("iconcaptcha-error"),d.querySelector("input[name='ic-hf-se']").setAttribute("value",null),IconCaptchaPolyfills.empty(c),c.insertAdjacentHTML("beforeend","<div class='iconcaptcha-modal__body-icons'></div>"),y(),IconCaptchaPolyfills.trigger(d,"refreshed",{captchaId:s})}function b(e,t){void 0!==e&&void 0!==t&&(f=!0,S(),e=Math.round(e),t=Math.round(t),d.querySelector('input[name="ic-hf-se"]').setAttribute("value",[e,t,p].join(",")),d.querySelector('input[name="ic-hf-id"]').setAttribute("value",s),r.style.display="none",t=P({i:s,x:e,y:t,w:p,a:2,tk:l}),IconCaptchaPolyfills.ajax({url:o.general.validationPath,type:"POST",headers:T(l),data:{payload:t},success:function(){c.classList.remove("captcha-opacity"),q(d.querySelector(".iconcaptcha-modal__body-selection"));var e=d.querySelectorAll(".iconcaptcha-modal__header, .iconcaptcha-modal__footer, .iconcaptcha-modal__body");i(e,(function(e){e.parentNode.removeChild(e)})),d.classList.add("iconcaptcha-success"),d.querySelector(".iconcaptcha-modal").innerHTML+='<div class="iconcaptcha-modal__body">'+'<div class="iconcaptcha-modal__body-title">'.concat(o.messages.correct,"</div>")+'<div class="iconcaptcha-modal__body-checkmark">'.concat('<svg viewBox="0 0 98.5 98.5" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><path class="checkmark" d="M81.7 17.8C73.5 9.3 62 4 49.2 4 24.3 4 4 24.3 4 49.2s20.3 45.2 45.2 45.2 45.2-20.3 45.2-45.2c0-8.6-2.4-16.6-6.5-23.4L45.6 68.2 24.7 47.3" fill="none" stroke-miterlimit="10" stroke-width="8"/></svg>',"</div>")+"<div class='iconcaptcha-modal__body-info'>"+"<a href='".concat(a,"' target='_blank' rel='follow' title='").concat(n,"'>IconCaptcha &copy;</a>")+"</div></div>",f=!1,IconCaptchaPolyfills.trigger(d,"success",{captchaId:s})},error:function(){return I()}}))}function I(e,t,a){a=!(2<arguments.length&&void 0!==a)||a,c.classList.remove("captcha-opacity"),q(d.querySelector(".iconcaptcha-modal__body-selection")),e=e||o.messages.incorrect.title,t=t||o.messages.incorrect.subtitle,d.classList.add("iconcaptcha-error"),c.innerHTML='<div class="iconcaptcha-modal__body-title">'.concat(e,"</div>")+'<div class="iconcaptcha-modal__body-subtitle">'.concat(t,"</div>"),f=!1,IconCaptchaPolyfills.trigger(d,"error",{captchaId:s}),a&&setTimeout(w,o.security.selectionResetDelay)}function C(){c.classList.add("captcha-opacity"),c.insertAdjacentHTML("beforeend",'<div class="captcha-loader"></div>')}function k(e){h=v=!1,0<arguments.length&&void 0!==e&&!e?w():(e=P({i:s,a:3,tk:l}),IconCaptchaPolyfills.ajax({url:o.general.validationPath,type:"post",headers:T(l),data:{payload:e},success:function(){IconCaptchaPolyfills.trigger(d,"invalidated",{captchaId:s}),w()},error:function(){return I()}}))}function S(){null!==u&&(clearTimeout(u),u=null)}function L(e,t,a){a=2<arguments.length&&void 0!==a?a:"",I("IconCaptcha Error",t,!1),console.error(a),e&&IconCaptchaPolyfills.trigger(d,"error",{captchaId:s})}function P(e){return btoa(JSON.stringify(_objectSpread(_objectSpread({},e),{},{ts:Date.now()})))}function T(e){return e?{"X-IconCaptcha-Token":e}:{}}function q(e){if(e&&e._ic_listeners)for(var t in e._ic_listeners)e.removeEventListener(t,e._ic_listeners[t])}function D(e){var t;null!=e.currentTarget&&(t=IconCaptchaPolyfills.offset(e.currentTarget),r.style.left=Math.round(e.pageX-t.left)-8+"px",r.style.top=Math.round(e.pageY-t.top)-7+"px")}L(!0,"IconCaptcha was configured incorrectly","The IconCaptcha option `validationPath` has not been set.")};return e}async function solveCaptcha(e){if(console.log("Solving.."),!await async function(e){return await new Promise((t=>{const a=new Image;a.onload=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height;var n=e.getContext("2d");n.drawImage(a,0,0);for(var i=n.getImageData(0,0,a.width,a.height).data,o=0,c=0,r=!0,l=0;l<i.length;l+=4)i[l]<=2&&i[l+1]<=2&&i[l+2]<=2&&i[l+3]>0&&c++,i[l]>=200&&i[l+1]>=200&&i[l+2]>=200&&i[l+3]>=200&&o++;c<o&&(r=!1),t(r)},a.src=e}))}(e)){const a=await function(e){const t=atob(e),a=new ArrayBuffer(t.length),n=new Uint8Array(a);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return a}(e.split(",")[1]),n=await Jimp.read(a);var t=await n.greyscale().invert();e=await t.getBase64Async(Jimp.AUTO)}function a(e){return new Promise(((t,a)=>{var n=new Image;n.src=e,n.onload=()=>{var e=document.createElement("canvas");e.width=n.width,e.height=n.height;var a=e.getContext("2d");a.drawImage(n,0,0);for(var i=a.getImageData(0,0,n.width,n.height).data,o=0,c=0;c<i.length;c+=4)i[c]<=2&&i[c+1]<=2&&i[c+2]<=2&&i[c+3]>0&&o++;t(o)},n.onerror=()=>{a("Error loading image")}}))}function n(e,t){var a=document.querySelector("div.iconcaptcha-modal__body > div.iconcaptcha-modal__body-selection"),n=a.getBoundingClientRect(),i=n.left+(n.right-n.left)*(t+1)/e-(n.right-n.left)/(2*e),o=(n.bottom+n.top)/2,c=document.createEvent("MouseEvent");c.initMouseEvent("mouseenter",!0,!0,window,0,i,o,i,o,!1,!1,!1,!1,0,null);var r=document.createEvent("MouseEvent");r.initMouseEvent("mousemove",!0,!0,window,0,i,o,i,o,!1,!1,!1,!1,0,null);var l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,0,i,o,i,o,!1,!1,!1,!1,0,null),a.dispatchEvent(c),a.dispatchEvent(r),a.dispatchEvent(l)}var i,o,c=await(i=e,o=250,new Promise(((e,t)=>{var a=new Image;a.src=i,a.onload=()=>{var t=document.createElement("canvas");t.width=a.width,t.height=a.height;var n=t.getContext("2d");n.drawImage(a,0,0);var i=n.getImageData(0,0,a.width,a.height);!function(e){for(var t=e.data,a=0;a<t.length;a+=4)t[a]=255-t[a],t[a+1]=255-t[a+1],t[a+2]=255-t[a+2]}(i),function(e,t){for(var a=e.data,n=0;n<a.length;n+=4){var i=(a[n]+a[n+1]+a[n+2])/3>=t?255:0;a[n]=i,a[n+1]=i,a[n+2]=i}}(i,o);var c=function(e,t){var a=e.width,n=e.height,i=e.data,o=document.createElement("canvas");o.width=a,o.height=n;for(var c=o.getContext("2d"),r=c.createImageData(a,n),l=r.data,s=0;s<n;s++)for(var d=0;d<a;d++){for(var h=0,u=0,p=-1;p<=1;p++)for(var v=-1;v<=1;v++){var g=d+v,f=s+p;if(!(g<0||g>=a||f<0||f>=n)){var m=4*(f*a+g),y=(i[m]+i[m+1]+i[m+2])/3,_=0==p&&0==v?4:1;h+=_*y*v,u+=_*y*p}}Math.sqrt(h*h+u*u)>=t&&(l[4*(s*a+d)]=255,l[4*(s*a+d)+1]=255,l[4*(s*a+d)+2]=255,l[4*(s*a+d)+3]=255)}return c.putImageData(r,0,0),o}(i,o),r=c.toDataURL(),l=new Image;l.src=r,l.onload=()=>{var a=t.getContext("2d");a.drawImage(l,0,0);var n=function(e){for(var t=e.width,a=e.height,n=e.data,i=[],o=0;o<t;o++){for(var c=!0,r=0;r<a;r++){var l=4*(r*t+o);if(255!=n[l]||255!=n[l+1]||255!=n[l+2]){c=!1;break}}c&&i.push(o)}for(var s=[],d=0;d<i.length;d++){var h=0==d?0:i[d-1]+1,u=d==i.length-1?t-1:i[d];if(u-h>0){var p=document.createElement("canvas");p.width=u-h,p.height=a,p.getContext("2d").putImageData(e,-h,0);var v=p.toDataURL();s.push(v)}}return s}(a.getImageData(0,0,l.width,l.height));e(n)}},a.onerror=()=>{t("Error loading image")}})));let r=[];for(let e=0;e<c.length;e++)e%2==0&&r.push(await a(c[e]));var l=new Set,s=new Set;for(let e=0;e<r.length;e++){let t=[];if(s.size==r.length)break;if(!s.has(e)){t.push(r[e]),s.add(e);for(let a=e+1;a<r.length;a++)s.has(a)||s.has(a)||0!=Math.abs(r[e]-r[a])||(t.push(r[a]),s.add(a));t.length>0&&l.add(t)}}var d=[];for(let e of l)(0==d.length||d.length>e.length)&&(d=e);if(d.length==r.length||d.length>=r.length/2)return console.log("Captcha cannot be solved"),console.log("Resetting and retrying"),void IconCaptcha.reset();let h=0;for(let e of l)e.length==d.length&&h++;if(h>1)console.log("Captcha cannot be solved");else for(let e=0;e<r.length;e++)if(d[0]==r[e]){n(r.length,e);break}}
